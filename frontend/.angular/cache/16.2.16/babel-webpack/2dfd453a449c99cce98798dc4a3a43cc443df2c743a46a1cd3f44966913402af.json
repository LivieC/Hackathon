{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { tap, switchMap } from 'rxjs/operators';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class AuthService {\n  http;\n  token = null;\n  constructor(http) {\n    this.http = http;\n  }\n  login(username, password) {\n    // OpenShift OAuth token endpoint\n    const tokenUrl = `${environment.openshiftUrl}/oauth/authorize/token`;\n    const credentials = btoa(`${username}:${password}`);\n    const headers = new HttpHeaders({\n      'Authorization': `Basic ${credentials}`,\n      'Content-Type': 'application/x-www-form-urlencoded'\n    });\n    const body = 'grant_type=password&scope=user:full';\n    return this.http.post(tokenUrl, body, {\n      headers\n    }).pipe(tap(response => {\n      this.token = response.access_token;\n    }), switchMap(() => {\n      // 确保 token 不为 null\n      if (!this.token) {\n        throw new Error('Failed to obtain token');\n      }\n      return this.sendTokenToBackend(this.token);\n    }));\n  }\n  sendTokenToBackend(token) {\n    return this.http.post(`${environment.apiUrl}/api/auth/token`, {\n      token\n    });\n  }\n  getToken() {\n    return this.token;\n  }\n  logout() {\n    this.token = null;\n  }\n  isLoggedIn() {\n    return this.token !== null;\n  }\n  static ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient));\n  };\n  static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["HttpHeaders","tap","switchMap","environment","AuthService","http","token","constructor","login","username","password","tokenUrl","openshiftUrl","credentials","btoa","headers","body","post","pipe","response","access_token","Error","sendTokenToBackend","apiUrl","getToken","logout","isLoggedIn","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["E:\\citi\\JavaTraining\\Project\\TA_Hackathon\\project01\\frontend\\src\\app\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { tap, switchMap } from 'rxjs/operators';\r\nimport { environment } from '../../environments/environment';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  private token: string | null = null;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  login(username: string, password: string): Observable<any> {\r\n    // OpenShift OAuth token endpoint\r\n    const tokenUrl = `${environment.openshiftUrl}/oauth/authorize/token`;\r\n    const credentials = btoa(`${username}:${password}`);\r\n    \r\n    const headers = new HttpHeaders({\r\n      'Authorization': `Basic ${credentials}`,\r\n      'Content-Type': 'application/x-www-form-urlencoded'\r\n    });\r\n\r\n    const body = 'grant_type=password&scope=user:full';\r\n\r\n    return this.http.post(tokenUrl, body, { headers }).pipe(\r\n      tap((response: any) => {\r\n        this.token = response.access_token;\r\n      }),\r\n      switchMap(() => {\r\n        // 确保 token 不为 null\r\n        if (!this.token) {\r\n          throw new Error('Failed to obtain token');\r\n        }\r\n        return this.sendTokenToBackend(this.token);\r\n      })\r\n    );\r\n  }\r\n\r\n  private sendTokenToBackend(token: string): Observable<any> {\r\n    return this.http.post(`${environment.apiUrl}/api/auth/token`, { token });\r\n  }\r\n\r\n  getToken(): string | null {\r\n    return this.token;\r\n  }\r\n\r\n  logout(): void {\r\n    this.token = null;\r\n  }\r\n\r\n  isLoggedIn(): boolean {\r\n    return this.token !== null;\r\n  }\r\n} "],"mappings":"AACA,SAAqBA,WAAW,QAAQ,sBAAsB;AAE9D,SAASC,GAAG,EAAEC,SAAS,QAAQ,gBAAgB;AAC/C,SAASC,WAAW,QAAQ,gCAAgC;;;AAK5D,OAAM,MAAOC,WAAW;EAGFC,IAAA;EAFZC,KAAK,GAAkB,IAAI;EAEnCC,YAAoBF,IAAgB;IAAhB,KAAAA,IAAI,GAAJA,IAAI;EAAe;EAEvCG,KAAKA,CAACC,QAAgB,EAAEC,QAAgB;IACtC;IACA,MAAMC,QAAQ,GAAG,GAAGR,WAAW,CAACS,YAAY,wBAAwB;IACpE,MAAMC,WAAW,GAAGC,IAAI,CAAC,GAAGL,QAAQ,IAAIC,QAAQ,EAAE,CAAC;IAEnD,MAAMK,OAAO,GAAG,IAAIf,WAAW,CAAC;MAC9B,eAAe,EAAE,SAASa,WAAW,EAAE;MACvC,cAAc,EAAE;KACjB,CAAC;IAEF,MAAMG,IAAI,GAAG,qCAAqC;IAElD,OAAO,IAAI,CAACX,IAAI,CAACY,IAAI,CAACN,QAAQ,EAAEK,IAAI,EAAE;MAAED;IAAO,CAAE,CAAC,CAACG,IAAI,CACrDjB,GAAG,CAAEkB,QAAa,IAAI;MACpB,IAAI,CAACb,KAAK,GAAGa,QAAQ,CAACC,YAAY;IACpC,CAAC,CAAC,EACFlB,SAAS,CAAC,MAAK;MACb;MACA,IAAI,CAAC,IAAI,CAACI,KAAK,EAAE;QACf,MAAM,IAAIe,KAAK,CAAC,wBAAwB,CAAC;;MAE3C,OAAO,IAAI,CAACC,kBAAkB,CAAC,IAAI,CAAChB,KAAK,CAAC;IAC5C,CAAC,CAAC,CACH;EACH;EAEQgB,kBAAkBA,CAAChB,KAAa;IACtC,OAAO,IAAI,CAACD,IAAI,CAACY,IAAI,CAAC,GAAGd,WAAW,CAACoB,MAAM,iBAAiB,EAAE;MAAEjB;IAAK,CAAE,CAAC;EAC1E;EAEAkB,QAAQA,CAAA;IACN,OAAO,IAAI,CAAClB,KAAK;EACnB;EAEAmB,MAAMA,CAAA;IACJ,IAAI,CAACnB,KAAK,GAAG,IAAI;EACnB;EAEAoB,UAAUA,CAAA;IACR,OAAO,IAAI,CAACpB,KAAK,KAAK,IAAI;EAC5B;;qBA7CWF,WAAW,EAAAuB,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA;EAAA;;WAAX1B,WAAW;IAAA2B,OAAA,EAAX3B,WAAW,CAAA4B,IAAA;IAAAC,UAAA,EAFV;EAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}